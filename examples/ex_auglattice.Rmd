# Setup
```{r setup}
require(devtools)
require(ggplot2)
require(annmatrix)
require(ggplotify)
require(patchwork)
require(parallel)
require(data.table)
require(stringr)
require(CVXR)
source('plotConfig.R')
load_all()
```

# Run solver

## Single run
```{r}
Nmeas=24
x0 = list(
  N1    = sample(c(4:20),1),
  shift2 =1/24,
  scale2 = 1
)
x0$N2 = Nmeas-x0$N1

control=list(
  N1min =  4,
  N1max = 20,
  maxit = 1e3,
  trace = 1,
  REPORT = 1
)
Nfreq = 2^10
freqs=seq(1,24,length.out=Nfreq)
res=solve_pin2lat(x0,freqs,control,cfuntype='ncp')
res$mtvalue
costfun_svdpower(res$mtvalue,freqs,cfuntype = 'ncp')
costfun_svdpower(c(1:Nmeas)/Nmeas-1/Nmeas,freqs,cfuntype = 'ncp')
```

## Parallel run
```{r}
control$maxit=1e3
nrep=1e1
c(1:nrep) %>% mclapply(mc.cores = 10,function(ind){
  x0 = list(
    N1    = sample(c(4:20),1),
    shift2 =1/24,
    scale2 = 1
  )
  x0$N2 = Nmeas-x0$N1
  x0$shift2 = 1/2/x0$N1
  solve_pin2lat(x0,freqs,control,cfuntype='ncp')
}) 
```