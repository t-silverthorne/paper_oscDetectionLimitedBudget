```{r}
require(dplyr)
require(devtools)
require(ggplot2)
require(data.table)
require(parallel)
require(patchwork)
require(lomb)
require(latex2exp)
load_all()
source('plotConfig.R')
Nmeas = 32 
mtu = c(1:Nmeas)/Nmeas - 1/Nmeas

df_cvxr=readRDS(paste0('figs_for_paper/solutions/solns_cvxr_sparse_',Nmeas,'.RDS'))

df_p2l =readRDS(paste0('figs_for_paper/solutions/solns_pin2lat_',Nmeas,'.RDS'))
df_p2l$ncp = abs(df_p2l$ncp) # consistent sign choice
maxrep     = df_p2l[which.max(df_p2l$ncp),]$rep
df_p2l     = df_p2l[df_p2l$rep==maxrep,] 

mtcvx=df_cvxr$time 
mtp2l=df_p2l$time

fmin=1
fmax=24
freqs = c(1,2,4,8,16) 
#acros = seq(0,2*pi,length.out = Nacro+1)
#acros = acros[1:(length(acros)-1)]
acros=c(0,pi/2,pi,3*pi/2)
ldf = rbind(
  lsp_pseudowindow(mtu,freqs,acros,type='uniform'),
  lsp_pseudowindow(mtcvx,freqs,acros,type='cvxr'),
  lsp_pseudowindow(mtp2l,freqs,acros,type='pin2lat')
) 
ldf=data.frame(ldf)
head(ldf)
ldf$type=factor(ldf$type,c('uniform','pin2lat','cvxr'))

names(ldf)[names(ldf)=='type']='solver'

ldf$acro_fac = round(ldf$acro,2)
af_vals = ldf$acro_fac %>% unique()
ldf$acro_fac = factor(ldf$acro_fac, 
                      levels=af_vals, 
                      c('0','pi/2','pi','3pi/2'))

appender = function(string){
  if (any(grep('pi',string))){
    TeX(paste('$\\',string,'$'))
  }else{
    string
  }
    
}

Fig=ldf%>% 
  ggplot(aes(x=lfreq,y=lpower,group=solver,color=solver))+geom_line()+
  facet_grid(freq~acro_fac,
             labeller = as_labeller(appender,default=label_parsed))+
  geom_vline(aes(xintercept = freq),linewidth=.25)+
  labs(x='frequency (cycles/day)',y='intensity')+
  theme(
     strip.background=element_blank(),
     text=element_text(size=9),
     plot.margin=margin(0,0,0,0),
     panel.grid.major = element_blank(),
     panel.grid.minor = element_blank(),
     axis.text.x = element_text(vjust = 0.25),
     legend.position = 'bottom'
  ) 
ggsave(paste0(overleaf_plot_directory,'lomgscargle.png'),Fig,width=6,height=5,device='png',dpi=600)
```